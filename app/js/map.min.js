/*
 MIT
 @version 0.3.0
*/
(function(f,k){"object"===typeof exports&&"function"===typeof require?exports.Map=k():"function"===typeof define&&define.amd?define(k):(f.__vm__=f.__vm__||{},f.__vm__.util=f.__vm__.util||{},f.__vm__.util.Map=k())})(this,function(){function f(l,h){for(var f in h)h.hasOwnProperty(f)&&!l.hasOwnProperty(f)&&(l[f]=h[f]);return l}var k=function(l,h,m){h=h||"_";var n={},g;if(Array.isArray(l))g=l;else{var r=0;g=[];f(n,l);for(var p in l)"function"!==typeof l[p]&&(g[r++]=p,n[p]=h)}var d={},q=0;this.toObjectKey=
function(a){if("string"===typeof a){a=a.replace(RegExp("\\\\/","g"),"\ue000").replace(RegExp("\\\\:","g"),"\ue001");a=a.split("/");for(var c={},b=0;b<a.length;b++){var e=a[b],d=e.indexOf(":"),f=-1===d?g[b]:e.substring(0,d),e=-1===d?e:e.substring(d+1),e=e.replace(RegExp("\ue000","g"),"/").replace(RegExp("\ue001","g"),":");c[f]=e}return c}return a};this.toStringKey=function(a,c){function b(a){return a.replace(RegExp(":","g"),"\\:").replace(RegExp("/","g"),"\\/")}"undefined"===typeof c&&(c=!0);if("object"===
typeof a){for(var e="",d=0;d<g.length;d++){var f=a[g[d]];"undefined"!==typeof f&&(0<e.length&&(e+="/"),c&&(e+=b(g[d])+":"),e+=b(f))}return e}return a};this.fields=function(){return g.slice()};this.of=function(a,c){"undefined"===typeof c&&(c=!0);a=this.toObjectKey(a);var b=a[g[0]];if("undefined"!==typeof b){var e=d[b];if(1===g.length)return e;if("undefined"===typeof e){if(c)return d[b]=new k(g.slice(1),h,this),d[b].of(a);return}return e.of(a)}return this};this.get=function(a,c){var b=this.of(f(a,n),
!1);return"undefined"!==typeof b?b:"function"===typeof c?c.call(this):c};this.getOrElseUpdate=function(a,c){var b=this.of(f(a,n),!1);"undefined"===typeof b&&(b="function"===typeof c?c.call(this):c,"undefined"!==typeof b&&this.put(a,b));return b};this.contains=function(a){return"undefined"!==typeof this.get(a)};this.put=function(a,c){a=this.toObjectKey(a);var b=a[g[0]],b="undefined"!==typeof b?b:h,e;1===g.length?(e=d[b],d[b]=c,"undefined"===typeof e&&this.__incrementSize()):((e=d[b])||(d[b]=e=new k(g.slice(1),
h,this)),e=e.put(a,c));return e};this.size=function(){return q};this.remove=function(a){if(d){a=this.toObjectKey(a);var c=a[g[0]],c="undefined"!==typeof c?c:h,b;1===g.length?(b=d[c],delete d[c],"undefined"!==typeof b&&this.__decrementSize()):(c=d[c])&&(b=c.remove(a));return b}};this.clear=this.removeAll=function(){if(d)for(var a in d)1===g.length?(delete d[a],this.__decrementSize()):d[a].clear()};this.keys=function(a){a="undefined"===typeof a?!1:a;var c=[];this.each(function(b){c.push(a?this.toStringKey(b):
b)},this);return c};this.values=function(){var a=[];this.each(function(c,b){a.push(b)});return a};this.filter=function(a,c){var b=new k(g,h);this.each(function(c,d,f){a.call(this,c,d,f)&&b.put(c,d)},c);return b};this.each=function(a,c){this.__each({},a,c||this,this)};this.__each=function(a,c,b,e){if(d)for(var h in d)a[g[0]]=h,1===g.length?c.call(b,f({},a),d[h],e):d[h].__each(a,c,b,e)};this.__incrementSize=function(){q++;m&&m.__incrementSize()};this.__decrementSize=function(){q--;m&&m.__decrementSize()}};
k.create=function(f,h){return new k(f,h)};return k});